var ThorIOClient={};ThorIOClient.Message=function(){function n(n,t,i){this.T=n;this.D=t;this.C=i;this.JSON={T:n,D:JSON.stringify(t),C:i}}return n.prototype.toString=function(){return JSON.stringify(this.JSON)},n}();ThorIOClient.Factory=function(){var t=function(){var n=function(n,t){this.alias=n;this.ws=t;this.listeners=[]};return n.prototype.connect=function(){return this.ws.send(new ThorIOClient.Message("$connect_",{},this.alias)),this},n.prototype.close=function(){return this.ws.send(new ThorIOClient.Message("$close_",{},this.alias)),this},n.prototype.on=function(n,t){return this.listeners.push({topic:n,fn:t}),this},n.prototype.off=function(n){var t=this.listeners.find(function(t,i){if(t.topic===n)return i});return index>=0&&this.listeners.slice(t,1),this},n.prototype.invoke=function(n,t,i){return this.ws.send(new ThorIOClient.Message(n,t,i||this.alias)),this},n.prototype.setProperty=function(n,t,i){var r="$set_"+n;return this.invoke(r,t,i||this.alias),this},n.prototype.dispatch=function(n,t){if(n==="$open_"){this.onopen([JSON.parse(t)]);return}if(n==="$close_")this.onclose([JSON.parse(t)]);else if(this.hasOwnProperty(n))this[n].apply(this,[JSON.parse(t)]);else{var i=this.listeners.find(function(t){return t.topic===n});i&&i.fn.apply(this,[JSON.parse(t)])}},n.prototype.onopen=function(){},n.prototype.onopen=function(){},n}(),n=function(n,i){var r=this,u=new WebSocket(n);this.controllers=i;this.channels=[];u.onmessage=function(n){var t=JSON.parse(n.data);r.getChannel(t.C).dispatch(t.T,t.D)};u.onopen=function(){r.controllers.forEach(function(n){r.channels.push(new t(n,r.ws))});r.onopen.apply(r,r.channels)};this.ws=u};return n.prototype.close=function(){this.ws.close()},n.prototype.getChannel=function(n){return this.channels.find(function(t){return t.alias===n})},n.prototype.removeChannel=function(){throw"Not yet implemented";},n.prototype.onopen=function(){},n}();